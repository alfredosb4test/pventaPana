var $iva=$("#txt_IVA").val(),error=0,$array_id=[],$array_cantidad=[],$array_cantidad_solicitada=[],$array_precio_prod=[],$existencias_prod=0,$aprobacion_card="",$img="",$cajaFocus="#txt_cj_nombre",$card="",$ultimo_codigo_prod="",$cont_generico=0,$itemRecuperados=!1,$fileItemsPend="";function img_mouseenter(e){console.log("event img_mouseenter"),$(e).mouseenter(function(e){altura_img=$(this).offset().top,altura_img>280?y_top=120:y_top=10,x=e.pageX-$(this).offset().left,y=e.pageY-$(this).offset().top,$(this).css("z-index","15").children("div.tooltip").css({top:y-y_top,left:x+15,display:"block"})}).mousemove(function(e){altura_img=$(this).offset().top,altura_img>280?y_top=120:y_top=10,x=e.pageX-$(this).offset().left,y=e.pageY-$(this).offset().top,$(this).children("div.tooltip").css({top:y-y_top,left:x+15})}).mouseleave(function(){$(this).css("z-index","1").children("div.tooltip").animate({opacity:"hide"},"fast")})}function key_cobrar(e,t){var a=e||window.event,o=a.charCode||a.keyCode;console.log("key_cobrar"+o),$recibe=$("#recibe").val(),$total=$("#txt_total").val(),$cambio=$recibe-$total,8==o&&$("#cambio_cliente").empty(),isNaN($cambio)||$cambio<0||$("#cambio_cliente").html($cambio.toFixed(2))}function key_buscar_producto(e,t){var a=e||window.event;13==(a.charCode||a.keyCode)&&("txt_cj_codigo"==$(t).attr("id")?buscar_producto($(t).val()):buscar_producto_devo($(t).val()))}function buscar_producto(e){$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded",url:"funciones/buscar_prod_caja.php",data:"accion=cj_buscar_producto&codigo="+e,beforeSend:function(){},success:function(t){$("#txt_cj_codigo").attr("value",""),$("#txt_cj_nombre").attr("value","");var a=jQuery.parseJSON(t);if($("#ajax_respuesta").empty(),"existe"==a.status){if($valor_cantidad=$("#select_cantidad_caja").val(),$precio_venta_proveedor=a.precio_provedor,$precio_venta=a.precio_venta,$precio_venta_mayoreo=a.precio_mayoreo,$cantidadMostrar=0,1==a.activar_cantidades){if(a.cantidad<=0)return void $("#ajax_items_alert").html('<div class="msg alerta_err">Producto sin existencias</div>');$cantidadMostrar=a.cantidad}else a.cantidad=1e3,$cantidadMostrar=0;if(a.cantidad<parseInt($valor_cantidad)&&1==a.activar_cantidades)return void $("#ajax_items_alert").html('<div class="msg alerta_err">La cantidad requerida excede al producto existente</div>');if($("#"+a.codigo).length)return $cantidad=parseInt($("#textbox_"+a.codigo).val())+parseInt($valor_cantidad),a.cantidad<$cantidad&&1==a.activar_cantidades?void $("#ajax_items_alert").html('<div class="msg alerta_err">La cantidad requerida excede al producto existente</div>'):($ganancia_precio_venta=$cantidad*($precio_venta-$precio_venta_proveedor),$ganancia_precio_mayoreo=$cantidad*($precio_venta_mayoreo-$precio_venta_proveedor),$precio_item_total=$cantidad*$precio_venta,$precio_item_total_mayoreo=$cantidad*$precio_venta_mayoreo,$("#textbox_"+a.codigo).attr("value",$cantidad),$("#textbox_precio0_0"+a.codigo).attr("value","$"+$precio_item_total.toFixed(2)),$("#textbox_precio1_1"+a.codigo).attr("value","$"+$precio_item_total_mayoreo.toFixed(2)),$("#textbox_precio0_0"+a.codigo).attr("ganancia",$ganancia_precio_venta.toFixed(2)),$("#textbox_precio1_1"+a.codigo).attr("ganancia",$ganancia_precio_mayoreo.toFixed(2)),$("#ajax_items_alert").empty(),$("#select_cantidad_caja option[value=1]").attr("selected",!0),void calcular_totales());$ganancia_precio_venta=$valor_cantidad*($precio_venta-$precio_venta_proveedor),$ganancia_precio_mayoreo=$valor_cantidad*($precio_venta_mayoreo-$precio_venta_proveedor),$precio_item_total=$valor_cantidad*$precio_venta,$precio_item_total_mayoreo=$valor_cantidad*$precio_venta_mayoreo,$caja_cantidad="<input type='text' style='width:25px' value='"+$valor_cantidad+"' id='textbox_"+a.codigo+"' class='txt_caja_precio' size='1' readonly>",$caja_precioMayoreo_item='<input type="text" status="inactivo" ganancia="'+$ganancia_precio_mayoreo.toFixed(2)+'" menudeo="'+$precio_item_total.toFixed(2)+'" proveedor="'+$precio_venta_proveedor+'" mayoreo="'+$precio_item_total_mayoreo.toFixed(2)+'" onclick="del_mayoreo(\''+a.codigo+'\')" style="display:none;border:1px solid #03F; padding:1px; height:25px;width:60px" value="$'+$precio_item_total_mayoreo.toFixed(2)+'" id="textbox_precio1_1'+a.codigo+'" codigo="'+a.codigo+'" id_tbl='+a.id+" prod_stock="+a.cantidad+'  class="txt_caja_precio f_amarillo hand" size="8" readonly>',$caja_precio_item='<input type="text" status="activo" ganancia="'+$ganancia_precio_venta.toFixed(2)+'" menudeo="'+$precio_item_total.toFixed(2)+'" proveedor="'+$precio_venta_proveedor+'" mayoreo="'+$precio_item_total_mayoreo.toFixed(2)+'" value="$'+$precio_item_total.toFixed(2)+'" id="textbox_precio0_0'+a.codigo+'" codigo="'+a.codigo+'" style="width:60px" id_tbl='+a.id+" prod_stock="+a.cantidad+'  class="txt_caja_precio" size="8" readonly>',"default_upfile.png"!=a.imagen?$class='class="thumbnail-item" onclick="img_mouseenter(this)"':$class='class="thumbnail-item"',$thumb="<div "+$class+'><a href="#" ><img height="46" width="58" src="img_productos/'+a.imagen+'"></a><div class="tooltip"><img src="img_productos/'+a.imagen+'" alt="" width="100" height="90" /><span class="overlay"></span></div></div>',a.nombre.length>=48?$item_nombre='<div class="item_nombre f_left"><div style="top: 5px; position: relative; float:left; width: 10%;"><img src="images/borrar.png" width="25" height="25" onclick="del_item(\''+a.codigo+'\')" class="hand" ></div><div style="top: 5px; position: relative; float:left; width: 89%;">\t<span id="cantidad0_0'+a.codigo+'">('+$cantidadMostrar+") \t "+a.nombre+"</span></div></div>":$item_nombre='<div class="item_nombre_corto f_left"><div style="top: 5px; position: relative; float:left; width: 10%;"><img src="images/borrar.png" width="25" height="25" onclick="del_item(\''+a.codigo+'\')" class="hand" ></div><div style="top: 5px; position: relative; float:left; width: 89%;">\t<span id="cantidad0_0'+a.codigo+'">('+$cantidadMostrar+") \t "+a.nombre+"</span></div></div>",$del_cantidad='<img src="images/cantidad_del.png" title="Disminuir" width="20" height="20" onclick="del_cantidad(\''+a.codigo+'\')" class="hand" style="top: 5px; position: relative;">',$add_cantidad='<img src="images/cantidad_add.png" title="Aumentar" width="20" height="20" onclick="add_cantidad(\''+a.codigo+"', '"+a.cantidad+'\')" class="hand" style="top: 5px; position: relative;">',$mayoreo='<img src="images/mayoreo.png" title="Precio Mayoreo" width="20" height="20" onclick="add_mayoreo(\''+e+'\')" class="hand" style="top: 5px; position: relative;">',$table_precio="<table border='0' width='100%' height='60'><tr><td width='50%'>"+$item_nombre+"</td><td width='30'>"+$thumb+"</td><td width='120' align='left'>"+$mayoreo+" "+$del_cantidad+" "+$add_cantidad+"</td><td width='20' align='right'>"+$caja_cantidad+"</td><td width='50' align='right'>"+$caja_precio_item+$caja_precioMayoreo_item+"</td></tr></table>",$("#ajax_items_add").append('<div class="item" id="'+a.codigo+'">'+$table_precio+"</div>"),$("#ajax_items_alert").empty(),$("#select_cantidad_caja option[value=1]").attr("selected",!0),$("#textbox_"+a.codigo).attr("value",$valor_cantidad),$ultimo_codigo_prod=a.codigo,calcular_totales(),$(".thumbnail-item").click()}"no_existe"==a.status&&$("#ajax_items_alert").html('<div class="msg alerta_err">Producto no existente</div>'),"error_sql"==a.status&&$("#ajax_items_alert").html('<div class="msg alerta_err">Problemas con el SQL</div>')},timeout:9e4,error:function(){$("#ajax_respuesta").html('<div class="msg alerta_err">Problemas con el Servidor</div>')}})}function buscar_producto_devo(e){$fecha=$("#f_devo").val(),console.log($fecha),$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded",url:"funciones/buscar_prod_caja.php",data:"accion=cj_buscar_producto&codigo="+e,beforeSend:function(){},success:function(e){var t=jQuery.parseJSON(e);$("#ajax_respuesta").empty(),"existe"==t.status&&($("#txt_id_prod").val(t.id),$("#ajax_dvlcion").html('<div align="center" class="msg alerta_ok t_verde_fuerte">'+t.nombre+"</div>")),"no_existe"==t.status&&($("#ajax_dvlcion").html('<div class="msg alerta_err">Producto no existente</div>'),$("#txt_id_prod").val("")),"error_sql"==t.status&&($("#ajax_dvlcion").html('<div class="msg alerta_err">Problemas con el SQL</div>'),$("#txt_id_prod").val(""))},timeout:9e4,error:function(){$("#ajax_respuesta").html('<div class="msg alerta_err">Problemas con el Servidor</div>')}})}function calcular_totales(){$subTotal=0,$("input[status^='activo']").each(function(){$subTotal+=parseFloat($(this).val().replace("$",""))}),$("#subTotal").html("$"+$subTotal.toFixed(2)),iva=$iva*$subTotal.toFixed(2)/100,total=iva+$subTotal,$("#total").html("$"+total.toFixed(2)),$("#txt_total").val(total.toFixed(2)),$($cajaFocus).focus()}function del_mayoreo(e){$("#textbox_precio1_1"+e).attr("status","inactivo").hide(),$("#textbox_precio0_0"+e).attr("status","activo").fadeIn("fast"),calcular_totales()}function add_mayoreo(e){$("#textbox_precio1_1"+e).attr("status","activo").fadeIn("fast"),$("#textbox_precio0_0"+e).attr("status","inactivo").hide(),calcular_totales()}function calcular_totales_menudeo(){$("input[id^='textbox_precio0_0']").each(function(){codigo=$(this).attr("codigo"),$cantidad=parseInt($("#textbox_"+codigo).val()),menudeo=parseFloat($(this).attr("menudeo"))*$cantidad,$("#textbox_precio0_0"+codigo).attr("value","$"+menudeo.toFixed(2)).attr("status","activo"),$(this).fadeIn("fast"),$("#textbox_precio1_1"+codigo).attr("status","inactivo").hide()}),calcular_totales()}function calcular_totales_mayoreo(){$("input[id^='textbox_precio1_1']").each(function(){codigo=$(this).attr("codigo"),$cantidad=parseInt($("#textbox_"+codigo).val()),mayoreo=parseFloat($(this).attr("mayoreo"))*$cantidad,$("#textbox_precio1_1"+codigo).attr("value","$"+mayoreo.toFixed(2)).attr("status","activo"),$(this).fadeIn("fast"),$("#textbox_precio0_0"+codigo).attr("status","inactivo").hide()}),calcular_totales()}function del_item(e){$("#"+e).remove(),$ultimo_codigo_prod="",$(".item").length<=0&&($itemRecuperados=!1),calcular_totales()}function add_cantidad(e,t){console.log(e),console.log(t),$cantidad=parseInt($("#textbox_"+e).val())+1,$cantidad>t?console.log("cantidad excedida"):($precio_venta_proveedor=parseFloat($("#textbox_precio0_0"+e).attr("proveedor")),$precio_menudeo=parseFloat($("#textbox_precio0_0"+e).attr("menudeo")),$precio_item_total_menudeo=$precio_menudeo*$cantidad,$precio_mayoreo=parseFloat($("#textbox_precio0_0"+e).attr("mayoreo")),$precio_item_total_mayoreo=$precio_mayoreo*$cantidad,$ganancia_precio_venta=$cantidad*($precio_menudeo-$precio_venta_proveedor),$ganancia_precio_mayoreo=$cantidad*($precio_mayoreo-$precio_venta_proveedor),$("#textbox_"+e).attr("value",$cantidad),$("#textbox_precio0_0"+e).attr("value","$"+$precio_item_total_menudeo.toFixed(2)),$("#textbox_precio1_1"+e).attr("value","$"+$precio_item_total_mayoreo.toFixed(2)),$("#textbox_precio0_0"+e).attr("ganancia",$ganancia_precio_venta.toFixed(2)),$("#textbox_precio1_1"+e).attr("ganancia",$ganancia_precio_mayoreo.toFixed(2)),calcular_totales(),$("#txt_cj_codigo").blur())}function del_cantidad(e){console.log(e),$cantidad=parseInt($("#textbox_"+e).val())-1,$precio_venta_proveedor=parseFloat($("#textbox_precio0_0"+e).attr("proveedor")),$cantidad<=0||($precio_menudeo=parseFloat($("#textbox_precio0_0"+e).attr("menudeo")),$precio_item_total_menudeo=$precio_menudeo*$cantidad,$precio_mayoreo=parseFloat($("#textbox_precio0_0"+e).attr("mayoreo")),$precio_item_total_mayoreo=$precio_mayoreo*$cantidad,$ganancia_precio_venta=$cantidad*($precio_menudeo-$precio_venta_proveedor),$ganancia_precio_mayoreo=$cantidad*($precio_mayoreo-$precio_venta_proveedor),$("#textbox_"+e).attr("value",$cantidad),$("#textbox_precio0_0"+e).attr("value","$"+$precio_item_total_menudeo.toFixed(2)),$("#textbox_precio1_1"+e).attr("value","$"+$precio_item_total_mayoreo.toFixed(2)),$("#textbox_precio0_0"+e).attr("ganancia",$ganancia_precio_venta.toFixed(2)),$("#textbox_precio1_1"+e).attr("ganancia",$ganancia_precio_mayoreo.toFixed(2)),calcular_totales())}function limpiar_datos_cobrar(){$("#popup_contenido, #ajax_respuesta, #cambio_cliente").empty(),$array_id=[],$array_cantidad=[],$array_cantidad_solicitada=[],$("#recibe, #txt_cj_codig, #txt_aprobacion_card").attr("value",""),$("#cont_aprobacion_card").hide(),$aprobacion_card="",$img="",$card="",$ultimo_codigo_prod="",$("#icon_card").attr("src","")}function updateCantDevo(e){console.log("updateCantDevo ",e)}function actualiza_devo_confirm(e){$(".lst_prod").empty(),$tbl='<table width="100%"><tr><th>Producto</th><th>Actual</th><th>Solicitada</th></tr>',$tr="",arrayDevo=[],$precioFinal=0,$gananciaFinal=0,$("#venta_"+e+" .td_producto").each(function(e){var t=parseFloat($(this).attr("cantOrg")),a=parseFloat($(this).attr("value")),o=$(this).attr("id_producto"),i=parseFloat($(this).attr("precio")),r=parseFloat($(this).attr("ganancia"));t!=a&&a<=t&&a>=0?(precioPubli=i/t,gan_cant=r/t,precio_provedor=precioPubli-gan_cant,precioNuevo=precioPubli*a,ganancia_nueva=precioNuevo-precio_provedor*a,$precioFinal+=precioNuevo,$gananciaFinal+=ganancia_nueva,prodDevo={devolucion:1,id_producto:o,cantidad:Number=a,precio:Number=precioNuevo,ganancia:Number=ganancia_nueva},$tr+='<tr class="f_verde2_ventas f_resalta_verde"><td>'+$(this).attr("prod_name")+'</td><td align="center">'+$(this).attr("cantOrg")+'</td><td align="center">'+$(this).attr("value")+"</td></tr>"):($precioFinal+=i,$gananciaFinal+=r,prodDevo={devolucion:0,id_producto:o,cantidad:Number=t,precio:Number=i,ganancia:Number=r}),arrayDevo.push(prodDevo)}),$tbl+=$tr+"</table>",$(".lst_prod").append($tbl),totales={precioFinal:Number=$precioFinal,gananciaFinal:Number=$gananciaFinal},arrayDevo.push(totales),$("#dialog_dvlcion").dialog({width:"60%",resizable:!1,show:{effect:"blind",pieces:8,duration:10},title:"Devolucion de Producto",close:function(e,t){$($cajaFocus).focus()},buttons:{Cancelar:function(){$("#txt_codigo_dvlcion, #txt_comentario_dvlcion, #txt_id_prod").val(""),$(this).dialog("close")},Guardar:function(){$motivo=$("#txt_comentario_dvlcion").val(),$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded",url:"crud_pventas.php",data:"accion=prod_devolucion&arrayDevo="+JSON.stringify(arrayDevo)+"&motivo="+$motivo+"&id_ventas_cajas="+e,beforeSend:function(){},success:function(e){$("#ajax_respuesta").empty();var t=jQuery.parseJSON(e);"venta_editada"==t.status&&$(".ui-dialog-content").dialog().dialog("close"),"no_update"==t.status&&$("#ajax_dvlcion_err").html('<div class="msg alerta_err">Problemas con el SQL</div>')},timeout:9e4,error:function(){$("#ajax_respuesta").html("Problemas con el servidor intente de nuevo.")}})}}})}function actualiza_deben(e,t){$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded",url:"crud_pventas.php",data:"accion=debenUpdate&id="+e+"&estatus="+t,beforeSend:function(){},success:function(t){"ok"==jQuery.parseJSON(t).status?($("#ajax_respuesta").empty(),$("#debe_"+e).remove()):$("#ajax_deben_lista").html('<div class="msg alerta_err">Problemas con el servidor.</div>')},timeout:9e4,error:function(){$("#ajax_respuesta").html("Problemas con el servidor intente de nuevo.")}})}function filePendiente(){$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded",url:"crud_pventas.php",data:"accion=filesPendientes",beforeSend:function(){},success:function(e){var t=jQuery.parseJSON(e);console.log(t),t.length&&($("#pendientes_prod").empty(),t.forEach(e=>{$nombreArr=e.split("#"),$nombre=$nombreArr[0].replace("$",":"),$idItemBorrar=$nombreArr[1].replace(".",""),console.log($nombre),imgBorrar=$("<img onClick=eliminarItemsPend('"+e+"')>").addClass("borrarListPend").attr("src","images/borrar.png"),imgBorrar=$("<div></div>").addClass("divImgListProd").append(imgBorrar),$nombre=$("<div onClick=getPendienteList('"+e+"')></div>").addClass("divNomListProd").text($nombre),productos=$("<div></div>").addClass("itemListProd").attr("id",$idItemBorrar).append(imgBorrar).append($nombre),$("#pendientes_prod").append(productos)}))},timeout:9e4,error:function(){$("#ajax_respuesta").html("Problemas con el servidor intente de nuevo.")}})}function getPendienteList(e){console.log(e),$itemRecuperados=!0,$fileItemsPend=e,$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded",url:"crud_pventas.php",data:"accion=filePendiente&fileTxt="+e,beforeSend:function(){},success:function(e){$("#ajax_items_add").empty().html(e),calcular_totales()},timeout:9e4,error:function(){$("#ajax_respuesta").html("Problemas con el servidor intente de nuevo.")}})}function eliminarItemsPend(e){$nombreArr=e.split("#"),$idItemBorrar=$nombreArr[1].replace(".",""),console.log("fileItemsPend::",$idItemBorrar),$("#dialog_del_pendientes").dialog({width:450,resizable:!1,show:{effect:"blind",pieces:8,duration:10},title:"Lista Pendiente",close:function(e,t){$(this).dialog("close")},buttons:{Aceptar:function(){$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded",url:"crud_pventas.php",data:"accion=filePendienteDel&fileTxt="+e,beforeSend:function(){},success:function(e){console.log(e),"ok_del"==jQuery.parseJSON(e).status?($("#"+$idItemBorrar).animate({opacity:.4},200,"linear",function(){$("#"+$idItemBorrar).remove()}),$("#dialog_del_pendientes").dialog("close"),$itemRecuperados&&$("#ajax_items_add").empty(),$itemRecuperados=!1):console.log("error al elimina el archivo")},timeout:9e4,error:function(){$("#ajax_respuesta").html("Problemas con el servidor intente de nuevo.")}})},Cancelar:function(){$(this).dialog("close")}}})}$(document).ready(function(e){function t(e){$fecha=$("#f_inicial").val(),$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded",url:"crud_pventas.php",data:"accion=debenLista&fecha="+$fecha+"&estatus="+e,beforeSend:function(){},success:function(e){$("#ajax_deben_lista").html(e),$("#ajax_respuesta").empty(),$("#dialog_deben_lista").dialog({width:850,resizable:!1,show:{effect:"blind",pieces:8,duration:10},title:"Clientes que deben",close:function(e,t){$(this).dialog("close")},buttons:{Regresar:function(){$("#dialog_deben").dialog("open"),$(this).dialog("close")},Cancelar:function(){$(this).dialog("close")}}})},timeout:9e4,error:function(){$("#ajax_respuesta").html("Problemas con el servidor intente de nuevo.")}})}$altura=$(window).height(),$("#ajax_items_add, #btn_productos").css("height",$altura-187),$("#txt_cj_codigo, #recibe, #txt_cj_nombre").bind("keydown.ctrl_j",function(e){return!1}),$(document).unbind(),$("#txt_cj_codigo, #txt_cj_nombre").bind("keydown.F2",function(e){$("#btn_caja_cobrar").click()}),$(document).bind("keydown.F2",function(e){$("#btn_caja_cobrar").click()}),$("#txt_cj_codigo, #txt_cj_nombre").bind("keydown.F3",function(e){$("#btn_caja_pago").click()}),$(document).bind("keydown.F3",function(e){$("#btn_caja_pago").click()}),$("#txt_cj_codigo, #txt_cj_nombre").bind("keydown.F4",function(e){$("#btn_generico").click()}),$(document).bind("keydown.F4",function(e){$("#btn_generico").click()}),$(document).bind("keydown",function(e){key=e.keyCode,39==key?$ultimo_codigo_prod&&(cantidadProd=$("#textbox_precio0_0"+$ultimo_codigo_prod).attr("prod_stock"),add_cantidad($ultimo_codigo_prod,cantidadProd)):37==key&&$ultimo_codigo_prod&&del_cantidad($ultimo_codigo_prod)}),filePendiente(),$($cajaFocus).focus(),$("#iva").html($iva+"%"),$("#f_inicial").datepicker({dateFormat:"yy-mm-dd",showAnim:"drop",showOn:"button",buttonImage:"images/calendario.png",buttonImageOnly:!0,maxDate:"+1Y",changeMonth:!0,changeYear:!0,numberOfMonths:1,changeMonth:!0,numberOfMonths:1,onClose:function(e){$("#f_final").datepicker("option","minDate",e)}}),$("#f_final").datepicker({dateFormat:"yy-mm-dd",showAnim:"drop",showOn:"button",buttonImage:"images/calendario.png",buttonImageOnly:!0,maxDate:"+1Y",changeMonth:!0,changeYear:!0,numberOfMonths:1,changeMonth:!0,numberOfMonths:1,onClose:function(e){$("#f_inicial").datepicker("option","maxDate",e)}}),$("#f_devo").datepicker({dateFormat:"yy-mm-dd",showAnim:"drop",showOn:"button",buttonImage:"images/calendario.png",buttonImageOnly:!0,maxDate:"+1Y",changeMonth:!0,changeYear:!0,numberOfMonths:1,changeMonth:!0,numberOfMonths:1}),$("#txt_cj_nombre").autocomplete({source:"crud_pventas.php?accion=autocompleta_producto_caja",minLength:3,select:function(e,t){buscar_producto(t.item.codigo),$("#txt_cj_nombre").attr("value","").focus()}}),$("#btn_maayoreo").toggle(function(){calcular_totales_mayoreo(),$(this).children().eq(0).html("Menudeo")},function(){calcular_totales_menudeo(),$(this).children().eq(0).html("Mayoreo")}),$("#btnPDF").click(function(){day=new Date,id=day.getTime(),$html=$("#ajax_items_add").clone(),URL="ticket_html.php?array_id="+$array_id+"&array_cantidad_solicitada="+$array_cantidad_solicitada+"&array_precio_prod="+$array_precio_prod+"&total="+$total+"&nombre_cajero="+$nombre_cajero,window.open(URL,"_blank","toolbar=yes, scrollbars=yes, resizable=yes, top=1, left=100, width=800, height=600")}),$("#btn_caja_pago").click(function(){$("#txt_catidad_retiro").addClass("text_box"),$("#dialog_salida_dinero").dialog({width:450,resizable:!1,show:{effect:"blind",pieces:8,duration:10},title:"Retiro / Ingreso",close:function(e,t){$($cajaFocus).focus()},buttons:{Cancelar:function(){$("#txt_catidad_retiro, #txt_comentario_retiro").val(""),$(this).dialog("close")},Aceptar:function(){error=0,$comentario_retiro=$("#txt_comentario_retiro").val(),$catidad_retiro=$("#txt_catidad_retiro").val(),$concepto=$("#opt_concepto").val(),valida_campo2(["txt_catidad_retiro"],"","","",["txt_catidad_retiro"],["#FFD13A"],["#E6FACB"]),error?$("#txt_catidad_retiro").focus():$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded",url:"crud_pventas.php",data:"accion=salida_dinero&comentario_retiro="+$comentario_retiro+"&catidad_retiro="+$catidad_retiro+"&concepto="+$concepto+"&rd="+Math.random(),beforeSend:function(){},success:function(e){"retiro_ingreso_registrada"==jQuery.parseJSON(e).status&&($("#txt_catidad_retiro, #txt_comentario_retiro").val(""),$("#ajax_respuesta").empty(),$("#dialog_salida_dinero").dialog("close"),$($cajaFocus).focus())},timeout:9e4,error:function(){$("#ajax_respuesta").html("Problemas con el servidor intente de nuevo.")}})}}})}),$(".card").click(function(){$img=$(this).attr("img"),$card=$(this).attr("card"),$("#icon_card").attr("src",$img),$("#cont_aprobacion_card").show("drop"),$("#txt_aprobacion_card").focus()}),$("#btn_ventas_realizadas").click(function(){$fecha=$("#f_inicial").val(),$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded",url:"crud_pventas.php",data:"accion=ventas_usuario&fecha="+$fecha,beforeSend:function(){},success:function(e){$("#ajax_ventas_usr").html(e),$("#ajax_respuesta").empty(),$("#dialog_ventas_usr").dialog({width:850,resizable:!1,show:{effect:"blind",pieces:8,duration:10},title:"Historial Ventas del Dia",close:function(e,t){$($cajaFocus).focus()},buttons:{Cancelar:function(){$(this).dialog("close")}}})},timeout:9e4,error:function(){$("#ajax_respuesta").html("Problemas con el servidor intente de nuevo.")}})}),$("#btn_pagos_realizados").click(function(){$fecha=$("#f_inicial").val(),$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded",url:"crud_pventas.php",data:"accion=pagos_usuario&fecha="+$fecha,beforeSend:function(){},success:function(e){$("#ajax_pagos_usr").html(e),$("#ajax_respuesta").empty(),$("#dialog_pagos_usr").dialog({width:850,resizable:!1,show:{effect:"blind",pieces:8,duration:10},title:"Historial Pagos del Dia",close:function(e,t){$($cajaFocus).focus()},buttons:{Cancelar:function(){$(this).dialog("close")}}})},timeout:9e4,error:function(){$("#ajax_respuesta").html("Problemas con el servidor intente de nuevo.")}})}),$("#btn_deben").click(function(){$("#txt_nombre_deben, #txt_catidad_deben, #txt_comentario_deben").attr("value",""),$("#txt_nombre_deben, #txt_catidad_deben").removeClass("text_box_alert").addClass("text_box"),$("#dialog_deben").dialog({width:440,resizable:!1,show:{effect:"blind",pieces:8,duration:10},title:"Pendiente de Pago",close:function(e,t){$($cajaFocus).focus()},buttons:{Cancelar:function(){$(this).dialog("close")},Pendientes:function(){$(this).dialog("close"),t("debe")},Pagados:function(){$(this).dialog("close"),t("pagado")},Guardar:function(){error=0,$nombre_deben=$("#txt_nombre_deben").val(),$catidad_deben=$("#txt_catidad_deben").val(),$comentario_deben=$("#txt_comentario_deben").val(),console.log($nombre_deben),valida_campo2(["txt_nombre_deben","txt_catidad_deben"],"","","",["txt_nombre_deben","txt_catidad_deben"],["#FFD13A"],["#E6FACB"]),error||(console.log($nombre_deben),$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded",url:"crud_pventas.php",data:"accion=debe_usuario&comentario_deben="+$comentario_deben+"&catidad_deben="+$catidad_deben+"&nombre_deben="+$nombre_deben+"&rd="+Math.random(),beforeSend:function(){},success:function(e){"ok"==jQuery.parseJSON(e).status&&($("#ajax_respuesta").empty(),$("#dialog_deben").dialog("close"),$($cajaFocus).focus())},timeout:9e4,error:function(){$("#ajax_respuesta").html("Problemas con el servidor intente de nuevo.")}}))}}})}),$("#btn_dvlcion").click(function(){$("#ajax_dvlcion, #ajax_dvlcion_err").empty(),$("#dialog_dvlcion").dialog({width:"90%",resizable:!1,show:{effect:"blind",pieces:8,duration:10},title:"Devolucion de Producto",close:function(e,t){$($cajaFocus).focus()},buttons:{Cancelar:function(){$("#txt_codigo_dvlcion, #txt_comentario_dvlcion, #txt_id_prod").val(""),$(this).dialog("close")},Guardar:function(){$id=$("#txt_id_prod").val(),$motivo=$("#txt_comentario_dvlcion").val(),""!=$id&&1!=$existencias_prod&&$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded",url:"crud_pventas.php",data:"accion=prod_devolucion&id="+$id+"&motivo="+$motivo,beforeSend:function(){},success:function(e){$("#ajax_respuesta").empty();var t=jQuery.parseJSON(e);"ok_update"==t.status&&($("#txt_codigo_dvlcion, #txt_comentario_dvlcion, #txt_id_prod").val(""),$("#dialog_dvlcion").dialog("close")),"no_update"==t.status&&$("#ajax_dvlcion_err").html('<div class="msg alerta_err">Problemas con el SQL</div>')},timeout:9e4,error:function(){$("#ajax_respuesta").html("Problemas con el servidor intente de nuevo.")}})}}})}),$("#btn_generico").click(function(){$("#ajax_generico, #ajax_generico_err").empty(),$("#dialog_generico").dialog({width:550,resizable:!1,show:{effect:"blind",pieces:8,duration:10},title:"Producto Generico",close:function(e,t){$($cajaFocus).focus(),$("#txt_nombre_generico, #txt_costo_generico, #txt_ganancia_generico").addClass("text_box")},buttons:{Cancelar:function(){$("#txt_nombre_generico, #txt_costo_generico, #txt_ganancia_generico").val(""),$(this).dialog("close")},Guardar:function(){error=0,$cont_generico++,$id=$("#txt_id_prod").val(),$valor_cantidad=1,$txt_nombre_generico=$("#txt_nombre_generico").val(),$precio_venta=$("#txt_costo_generico").val(),$ganancia_gen=$("#txt_ganancia_generico").val(),$precio_venta_mayoreo=$("#txt_costo_generico").val(),$precio_venta_proveedor=$precio_venta-$ganancia_gen,valida_campo2(["txt_nombre_generico","txt_costo_generico"],"","","",["txt_nombre_generico","txt_costo_generico"],["#FFD13A"],["#E6FACB"]),error||($.isNumeric($precio_venta)&&$.isNumeric($ganancia_gen)?($id_prod_generico="1433-"+$cont_generico,$ganancia_gen*=1,$codigo="prod_generico_"+$cont_generico,$precio_item_total=$valor_cantidad*$precio_venta,$precio_item_total_mayoreo=$valor_cantidad*$precio_venta_mayoreo,$caja_cantidad="<input type='text' value='"+$valor_cantidad+"' id='textbox_"+$codigo+"' class='txt_caja_precio' size='1' readonly>",$caja_precioMayoreo_item='<input type="text" status="inactivo" ganancia="'+$ganancia_gen.toFixed(2)+'" proveedor="'+$precio_venta_proveedor+'" menudeo="'+$precio_item_total.toFixed(2)+'" mayoreo="'+$precio_item_total_mayoreo.toFixed(2)+'" onclick="del_mayoreo(\''+$codigo+'\')" style="display:none;border:1px solid #03F; padding:1px; height:25px;" value="$'+$precio_item_total_mayoreo.toFixed(2)+'" id="textbox_precio1_1'+$codigo+'" codigo="'+$codigo+'" id_tbl='+$id_prod_generico+" prod_stock="+$valor_cantidad+'  class="txt_caja_precio f_amarillo hand" size="8" readonly>',$caja_precio_item='<input type="text" status="activo" ganancia="'+$ganancia_gen.toFixed(2)+'" proveedor="'+$precio_venta_proveedor+'" menudeo="'+$precio_item_total.toFixed(2)+'" mayoreo="'+$precio_item_total_mayoreo.toFixed(2)+'" value="$'+$precio_item_total.toFixed(2)+'" id="textbox_precio0_0'+$codigo+'" codigo="'+$codigo+'" id_tbl='+$id_prod_generico+" prod_stock="+$valor_cantidad+'  class="txt_caja_precio" size="8" readonly>',$txt_nombre_generico.length>=48?$item_nombre='<div class="item_nombre f_left"><img src="images/borrar.png" width="25" height="25" onclick="del_item(\''+$codigo+'\')" class="hand" style="top: 5px; position: relative;"><span id="cantidad0_0'+$codigo+'">('+$valor_cantidad+") \t "+$txt_nombre_generico+"</span></div>":$item_nombre='<div class="item_nombre_corto f_left"><img src="images/borrar.png" width="25" height="25" onclick="del_item(\''+$codigo+'\')" class="hand" style="top: 5px; position: relative;"><span id="cantidad0_0'+$codigo+'">('+$valor_cantidad+") \t "+$txt_nombre_generico+"</span></div>",$del_cantidad='<img src="images/cantidad_del.png" title="Disminuir" width="25" height="25" onclick="del_cantidad(\''+$codigo+'\')" class="hand" style="top: 5px; position: relative;">',$add_cantidad='<img src="images/cantidad_add.png" title="Aumentar" width="25" height="25" onclick="add_cantidad(\''+$codigo+'\')" class="hand" style="top: 5px; position: relative;">',$table_precio="<table border='0' width='100%' height='46'><tr><td width='60%'>"+$item_nombre+"</td><td width='30%' align='right'>"+$del_cantidad+" - "+$add_cantidad+"</td><td width='30'>"+$caja_cantidad+"</td><td width='80'>"+$caja_precio_item+$caja_precioMayoreo_item+"</td></tr></table>",$("#ajax_items_add").append('<div class="item" id="'+$codigo+'" nombre_generico="'+$txt_nombre_generico+'">'+$table_precio+"</div>"),$("#ajax_items_alert").empty(),$("#select_cantidad_caja option[value=1]").attr("selected",!0),$("#textbox_"+$codigo).attr("value",$valor_cantidad),calcular_totales(),$("#txt_nombre_generico, #txt_costo_generico, #txt_ganancia_generico").val(""),$(this).dialog("close")):$("#ajax_generico_err").html('<div class="msg alerta_err">Cantidad no valida.</div>'))}}})}),$("#btn_caja_cobrar").click(function(){$array_id=[],$array_nomb_generico=[],$array_cantidad=[],$array_cantidad_solicitada=[],$array_ganancia_prod=[],$array_precio_prod=[],$ganancia_total=0,$("#recibe").attr("value",""),$(".item").length&&($nombre_cajero=$("#txt_usr_nombre").val(),$total=$("#txt_total").val(),$nombre="<tr><td>Cajero:</td><td class='t_azul_fuerte'>"+$nombre_cajero+"</td></tr>",$("#td_total_cobrar").html($total),$("input[status^='activo']").each(function(){$id_tbl=$(this).attr("id_tbl"),$precio=$(this).val(),$id=$(this).attr("codigo"),$ganancia=parseFloat($(this).attr("ganancia")),$ganancia_total+=$ganancia,-1!==$id_tbl.indexOf("-")&&($obj_nomb_generico=new Object,$id_generico=$id_tbl.split("-"),$nombre_generico=$("#prod_generico_"+$id_generico[1]).attr("nombre_generico"),$obj_nomb_generico.id=$id_generico[1],$obj_nomb_generico.nom=$nombre_generico,$array_nomb_generico.push($obj_nomb_generico)),$array_id.push($id_tbl),$array_precio_prod.push($precio),$array_ganancia_prod.push($ganancia),$cantidad=$("#textbox_"+$id).val(),$stock=$(this).attr("prod_stock"),$array_cantidad.push($stock-$cantidad),$array_cantidad_solicitada.push($cantidad)}),$array_nomb_generico.length?$JSON_nomb_generico=JSON.stringify($array_nomb_generico):$JSON_nomb_generico="",$("#popup_contenido").html("<table class='font_15'>"+$nombre+"</table>"),$("#recibe").focus(),$("#dialog_detalles").dialog({width:450,resizable:!1,show:{effect:"blind",pieces:8,duration:10},title:"Cobrar",closeOnEscape:!0,close:function(e,t){limpiar_datos_cobrar(),$(this).dialog("close"),$($cajaFocus).focus()},buttons:{Cancelar:function(){limpiar_datos_cobrar(),$(this).dialog("close"),$($cajaFocus).focus()},Aceptar:function(){""==($aprobacion_card=$("#txt_aprobacion_card").val())&&($card=""),$itemRecuperados&&eliminarItemsPend($fileItemsPend),$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded",url:"crud_pventas.php",data:"accion=update_productos&array_id="+$array_id+"&array_cantidad="+$array_cantidad+"&array_cantidad_solicitada="+$array_cantidad_solicitada+"&array_precio_prod="+$array_precio_prod+"&array_ganancia_prod="+$array_ganancia_prod+"&ganancia_total="+$ganancia_total+"&total="+$total+"&card="+$card+"&aprobacion_card="+$aprobacion_card+"&nombre_genericos="+$JSON_nomb_generico+"&rd="+Math.random(),beforeSend:function(){},success:function(e){console.log(e);var t=jQuery.parseJSON(e);"ok_insert"==t.status&&($("#ajax_respuesta, #ajax_items_add, #ajax_items_alert").empty(),$("#subTotal, #total").html(""),$("#dialog_detalles").dialog("close"),$($cajaFocus).focus(),$aprobacion_card="",$img="",$("#icon_card").attr("src","")),"error"==t.status&&console.log("error update.insert")},timeout:9e4,error:function(){$("#ajax_respuesta").html("Problemas con el servidor intente de nuevo.")}})}}}))})}),$("#dialog_detalles").keydown(function(e){if(13==e.keyCode)return $(this).parent().find("button:eq(2)").click(),!1}),$("#btn_guardar_list").click(function(){var e="";$(".item").length&&($(".item").each(function(t){e+=$(this).context.outerHTML}),f=new Date,fecha=f.getDate()+"-"+(f.getMonth()+1)+"-"+f.getFullYear()+"_"+f.getHours()+"$"+f.getMinutes(),$.ajax({url:"crud_pventas.php",contentType:"application/x-www-form-urlencoded",type:"POST",data:"accion=fileCaja&tmpCaja="+e+"&fecha="+fecha,processData:!1}).done(function(e){console.log("btn_guardar_list -> archivo guardado"),$(".item").fadeOut("fast"),setTimeout(()=>{$("#ajax_items_add").empty()},1e3),filePendiente()}))});